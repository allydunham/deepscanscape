# TODO deeper tests of this
test_that("annotation work", {
  x <- annotate(deep_scans$hsp90)
  expect_equal(x$data$cluster, c("Q4", "F2", "G3", "W1", "S1", "AA", "NA", "M1", "E2"))
})

test_that("calculate_cluster_distances works", {
  pca_mat <- matrix(
    c(-0.13, -0.25, 0.069, -1.4, 0.53, 0.59, -0.058, -1, -0.44, -0.15, -0.57, -0.27, -0.74, 0.39, 0.69, -0.32, -0.42,
      -0.21, 0.28, -0.85, -0.87, 0.069, -0.083, -0.46, -0.28, 0.053, -0.17, -0.2, 0.32, 0.22, -0.95, 0.25, -0.56, 0.21,
      0.16, 0.36, 0.027, -0.39, -0.72, 0.15, -0.26, -0.54, -1, 0.25, 0.23, -0.16, -0.38, -0.095, 0.078, -0.52, -0.11,
      -0.61, 0.093, -0.18, -0.023, -0.0098, -0.46, 0.012, 0.43, -0.11, -0.13, -0.8, -0.31, 0.03, -0.41, 0.00033, -0.27,
      -0.13, 0.25, -0.33, 0.094, -0.072, -0.15, 0.13, 0.19, -0.15, -0.12, -0.085, -0.04, -0.43, -0.25, -0.1, 0.062,
      0.47, 0.26, 0.21, 0.14, 0.14, -0.011, -0.34, -0.14, 0.11, 0.16, 0.17, -0.3, 0.038, 0.05, 0.012, -0.14, 0.21,
      -0.078, -0.01, -0.21, -0.49, -0.15, -0.2, 0.12, 0.18, 0.1, -0.034, 0.12, 0.18, -0.00059, 0.079, -0.11, 0.15,
      -0.17, 0.035, 0.2, -0.3, -0.03, -0.3, 0.17, -0.26, -0.25, -0.21, -0.01, 0.077, -0.12, 0.042, -0.39, 0.18, 0.015,
      -0.066, 0.088, 0.016, 0.11, -0.48, 0.21, 0.35, -0.25, 0.23, 0.094, 0.19, 0.18, -0.16, 0.15, 0.032, -0.49, 0.04,
      0.26, 0.21, 0.39, 0.00022, -0.25, -0.031, 0.028, 0.095, 0.3, 0.16, 0.14, -0.064, 0.07, -0.24, 0.14, 0.087, 0.14,
      0.27, -0.045, -0.29, 0.04),
    ncol = 19, byrow = TRUE
  )
  aa <- c("Q", "F", "G", "W", "S", "A", "N", "M", "E")

  expectation <- matrix(c(0.545, 0.319, 0.474, 0.526, 0.525, 0.436, 0.469, 0.493, 0.406,
                          0.617, 0.317, 0.502, 0.427, 0.587, 0.558, 0.532, 0.433, 0.505,
                          0.427, 0.434, 0.516, NA, 0.45, 0.643, NA, NA, 0.443,
                          0.456, NA, 0.635, NA, 0.546, 0.469, NA, NA, NA,
                          0.587, NA, 0.475, NA, 0.461, 0.484, NA, NA, NA,
                          NA, NA, 0.445, NA, NA, NA, NA, NA, NA,
                          NA, NA, 0.31, NA, NA, NA, NA, NA, NA,
                          NA, NA, NA, NA, NA, NA, NA, NA, NA), ncol = 8)
  colnames(expectation) <- paste0("dist", 1:8)
  expect_equal(signif(calculate_cluster_distances(aa, pca_mat), 3), expectation)
})
